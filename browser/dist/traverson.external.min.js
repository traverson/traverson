require=function a(b,c,d){function e(g,h){if(!c[g]){if(!b[g]){var i="function"==typeof require&&require;if(!h&&i)return i(g,!0);if(f)return f(g,!0);throw new Error("Cannot find module '"+g+"'")}var j=c[g]={exports:{}};b[g][0].call(j.exports,function(a){var c=b[g][1][a];return e(c?c:a)},j,j.exports,a,b,c,d)}return c[g].exports}for(var f="function"==typeof require&&require,g=0;g<d.length;g++)e(d[g]);return e}({1:[function(a,b){"use strict";function c(a){null==a&&(a=""),this.id=a}function d(a){return new c(a)}var e=!1;c.prototype.enable=function(){this.enabled=!0},c.prototype.debug=function(a){e&&console.log(this.id+"/debug: "+a)},c.prototype.info=function(a){e&&console.log(this.id+"/info: "+a)},c.prototype.warn=function(a){e&&console.log(this.id+"/warn: "+a)},c.prototype.error=function(a){e&&console.log(this.id+"/error: "+a)},d.enable=function(){e=!0},b.exports=d},{}],2:[function(a,b){"use strict";b.exports={isArray:function(a){return null==a?!1:"[object Array]"===Object.prototype.toString.call(a)}}},{}],3:[function(a,b){"use strict";function c(){this.options={}}function d(a,b,c){return e(a,b),f(a,b),g(a,b),h(a,b,c),a}function e(a,b){var c=b.qs;null!=c&&(a=a.query(c))}function f(a,b){var c=b.headers;null!=c&&(a=a.set(c))}function g(a,b){var c=b.auth;null!=c&&(a=a.auth(c.user||c.username,c.pass||c.password))}function h(a,b,c){if(null!=c){var d=c.body;null!=d&&(a=a.send(d))}}function i(a){return a.body=a.text,a.statusCode=a.status,a}var j=a("../third-party/superagent");c.prototype.defaults=function(a){var b=new c;return b.options=a,b},c.prototype.get=function(a,b){d(j.get(a),this.options).end(function(a){b(null,i(a))})},c.prototype.post=function(a,b,c){d(j.post(a),this.options,b).end(function(a){c(null,i(a))})},c.prototype.put=function(a,b,c){d(j.put(a),this.options,b).end(function(a){c(null,i(a))})},c.prototype.patch=function(a,b,c){d(j.patch(a),this.options,b).end(function(a){c(null,i(a))})},c.prototype.del=function(a,b,c){d(j.del(a),this.options).end(function(a){c(null,i(a))})},b.exports=new c},{"../third-party/superagent":6}],4:[function(a,b){"use strict";var c={startsWith:function(a,b){return""===b?!0:null==a||null==b?!1:(a=String(a),b=String(b),a.length>=b.length&&a.slice(0,b.length)===b)},endsWith:function(a,b){return""===b?!0:null==a||null==b?!1:(a=String(a),b=String(b),a.length>=b.length&&a.slice(a.length-b.length)===b)},splice:function(a,b,d,e){var f=c.chars(a);return f.splice(~~b,~~d,e),f.join("")},contains:function(a,b){return""===b?!0:null==a?!1:-1!==String(a).indexOf(b)},chars:function(a){return null==a?[]:String(a).split("")}};b.exports=c},{}],5:[function(a,b,c){"use strict";var d=a("resolve-url");c.resolve=function(a,b){return d(a,b)}},{"resolve-url":21}],6:[function(a,b,c){!function(){function a(b,c,d){var e=a.resolve(b);if(null==e){d=d||b,c=c||"root";var f=new Error('Failed to require "'+d+'" from "'+c+'"');throw f.path=d,f.parent=c,f.require=!0,f}var g=a.modules[e];return g.exports||(g.exports={},g.client=g.component=!0,g.call(this,g.exports,a.relative(e),g)),g.exports}a.modules={},a.aliases={},a.resolve=function(b){"/"===b.charAt(0)&&(b=b.slice(1));for(var c=b+"/index.js",d=[b,b+".js",b+".json",b+"/index.js",b+"/index.json"],e=0;e<d.length;e++){var b=d[e];if(a.modules.hasOwnProperty(b))return b}return a.aliases.hasOwnProperty(c)?a.aliases[c]:void 0},a.normalize=function(a,b){var c=[];if("."!=b.charAt(0))return b;a=a.split("/"),b=b.split("/");for(var d=0;d<b.length;++d)".."==b[d]?a.pop():"."!=b[d]&&""!=b[d]&&c.push(b[d]);return a.concat(c).join("/")},a.register=function(b,c){a.modules[b]=c},a.alias=function(b,c){if(!a.modules.hasOwnProperty(b))throw new Error('Failed to alias "'+b+'", it does not exist');a.aliases[c]=b},a.relative=function(b){function c(a,b){for(var c=a.length;c--;)if(a[c]===b)return c;return-1}function d(c){var e=d.resolve(c);return a(e,b,c)}var e=a.normalize(b,"..");return d.resolve=function(d){var f=d.charAt(0);if("/"==f)return d.slice(1);if("."==f)return a.normalize(e,d);var g=b.split("/"),h=c(g,"deps")+1;return h||(h=0),d=g.slice(0,h+1).join("/")+"/deps/"+d},d.exists=function(b){return a.modules.hasOwnProperty(d.resolve(b))},d},a.register("component-indexof/index.js",function(a,b,c){var d=[].indexOf;c.exports=function(a,b){if(d)return a.indexOf(b);for(var c=0;c<a.length;++c)if(a[c]===b)return c;return-1}}),a.register("component-emitter/index.js",function(a,b,c){function d(a){return a?e(a):void 0}function e(a){for(var b in d.prototype)a[b]=d.prototype[b];return a}var f=b("indexof");c.exports=d,d.prototype.on=function(a,b){return this._callbacks=this._callbacks||{},(this._callbacks[a]=this._callbacks[a]||[]).push(b),this},d.prototype.once=function(a,b){function c(){d.off(a,c),b.apply(this,arguments)}var d=this;return this._callbacks=this._callbacks||{},b._off=c,this.on(a,c),this},d.prototype.off=d.prototype.removeListener=d.prototype.removeAllListeners=function(a,b){if(this._callbacks=this._callbacks||{},0==arguments.length)return this._callbacks={},this;var c=this._callbacks[a];if(!c)return this;if(1==arguments.length)return delete this._callbacks[a],this;var d=f(c,b._off||b);return~d&&c.splice(d,1),this},d.prototype.emit=function(a){this._callbacks=this._callbacks||{};var b=[].slice.call(arguments,1),c=this._callbacks[a];if(c){c=c.slice(0);for(var d=0,e=c.length;e>d;++d)c[d].apply(this,b)}return this},d.prototype.listeners=function(a){return this._callbacks=this._callbacks||{},this._callbacks[a]||[]},d.prototype.hasListeners=function(a){return!!this.listeners(a).length}}),a.register("RedVentures-reduce/index.js",function(a,b,c){c.exports=function(a,b,c){for(var d=0,e=a.length,f=3==arguments.length?c:a[d++];e>d;)f=b.call(null,f,a[d],++d,a);return f}}),a.register("superagent/lib/client.js",function(a,b,c){function d(){}function e(a){var b={}.toString.call(a);switch(b){case"[object File]":case"[object Blob]":case"[object FormData]":return!0;default:return!1}}function f(){if(r.XMLHttpRequest&&("file:"!=r.location.protocol||!r.ActiveXObject))return new XMLHttpRequest;try{return new ActiveXObject("Microsoft.XMLHTTP")}catch(a){}try{return new ActiveXObject("Msxml2.XMLHTTP.6.0")}catch(a){}try{return new ActiveXObject("Msxml2.XMLHTTP.3.0")}catch(a){}try{return new ActiveXObject("Msxml2.XMLHTTP")}catch(a){}return!1}function g(a){return a===Object(a)}function h(a){if(!g(a))return a;var b=[];for(var c in a)b.push(encodeURIComponent(c)+"="+encodeURIComponent(a[c]));return b.join("&")}function i(a){for(var b,c,d={},e=a.split("&"),f=0,g=e.length;g>f;++f)c=e[f],b=c.split("="),d[decodeURIComponent(b[0])]=decodeURIComponent(b[1]);return d}function j(a){var b,c,d,e,f=a.split(/\r?\n/),g={};f.pop();for(var h=0,i=f.length;i>h;++h)c=f[h],b=c.indexOf(":"),d=c.slice(0,b).toLowerCase(),e=s(c.slice(b+1)),g[d]=e;return g}function k(a){return a.split(/ *; */).shift()}function l(a){return q(a.split(/ *; */),function(a,b){var c=b.split(/ *= */),d=c.shift(),e=c.shift();return d&&e&&(a[d]=e),a},{})}function m(a,b){b=b||{},this.xhr=a,this.text=a.responseText,this.setStatusProperties(a.status),this.header=this.headers=j(a.getAllResponseHeaders()),this.header["content-type"]=a.getResponseHeader("content-type"),this.setHeaderProperties(this.header),this.body=this.parseBody(this.text)}function n(a,b){var c=this;p.call(this),this._query=this._query||[],this.method=a,this.url=b,this.header={},this._header={},this.set("X-Requested-With","XMLHttpRequest"),this.on("end",function(){var b=new m(c.xhr);"HEAD"==a&&(b.text=null),c.callback(null,b)})}function o(a,b){return"function"==typeof b?new n("GET",a).end(b):1==arguments.length?new n("GET",a):new n(a,b)}var p=b("emitter"),q=b("reduce"),r="undefined"==typeof window?this:window,s="".trim?function(a){return a.trim()}:function(a){return a.replace(/(^\s*|\s*$)/g,"")};o.serializeObject=h,o.parseString=i,o.types={html:"text/html",json:"application/json",urlencoded:"application/x-www-form-urlencoded",form:"application/x-www-form-urlencoded","form-data":"application/x-www-form-urlencoded"},o.serialize={"application/x-www-form-urlencoded":h,"application/json":JSON.stringify},o.parse={"application/x-www-form-urlencoded":i,"application/json":JSON.parse},m.prototype.get=function(a){return this.header[a.toLowerCase()]},m.prototype.setHeaderProperties=function(){var a=this.header["content-type"]||"";this.type=k(a);var b=l(a);for(var c in b)this[c]=b[c]},m.prototype.parseBody=function(a){var b=o.parse[this.type];return b?b(a):null},m.prototype.setStatusProperties=function(a){var b=a/100|0;this.status=a,this.statusType=b,this.info=1==b,this.ok=2==b,this.clientError=4==b,this.serverError=5==b,this.error=4==b||5==b?this.toError():!1,this.accepted=202==a,this.noContent=204==a||1223==a,this.badRequest=400==a,this.unauthorized=401==a,this.notAcceptable=406==a,this.notFound=404==a,this.forbidden=403==a},m.prototype.toError=function(){var a="got "+this.status+" response",b=new Error(a);return b.status=this.status,b},o.Response=m,n.prototype=new p,n.prototype.constructor=n,n.prototype.timeout=function(a){return this._timeout=a,this},n.prototype.clearTimeout=function(){return this._timeout=0,clearTimeout(this._timer),this},n.prototype.abort=function(){return this.aborted?void 0:(this.aborted=!0,this.xhr.abort(),this.clearTimeout(),this.emit("abort"),this)},n.prototype.set=function(a,b){if(g(a)){for(var c in a)this.set(c,a[c]);return this}return this._header[a.toLowerCase()]=b,this.header[a]=b,this},n.prototype.getHeader=function(a){return this._header[a.toLowerCase()]},n.prototype.type=function(a){return this.set("Content-Type",o.types[a]||a),this},n.prototype.auth=function(a,b){var c=btoa(a+":"+b);return this.set("Authorization","Basic "+c),this},n.prototype.query=function(a){return"string"!=typeof a&&(a=h(a)),a&&this._query.push(a),this},n.prototype.send=function(a){var b=g(a),c=this.getHeader("Content-Type");if(b&&g(this._data))for(var d in a)this._data[d]=a[d];else"string"==typeof a?(c||this.type("form"),c=this.getHeader("Content-Type"),this._data="application/x-www-form-urlencoded"==c?this._data?this._data+"&"+a:a:(this._data||"")+a):this._data=a;return b?(c||this.type("json"),this):this},n.prototype.callback=function(a,b){var c=this._callback;return 2==c.length?c(a,b):a?this.emit("error",a):void c(b)},n.prototype.crossDomainError=function(){var a=new Error("Origin is not allowed by Access-Control-Allow-Origin");a.crossDomain=!0,this.callback(a)},n.prototype.timeoutError=function(){var a=this._timeout,b=new Error("timeout of "+a+"ms exceeded");b.timeout=a,this.callback(b)},n.prototype.withCredentials=function(){return this._withCredentials=!0,this},n.prototype.end=function(a){var b=this,c=this.xhr=f(),g=this._query.join("&"),h=this._timeout,i=this._data;if(this._callback=a||d,this._withCredentials&&(c.withCredentials=!0),c.onreadystatechange=function(){return 4==c.readyState?0==c.status?b.aborted?b.timeoutError():b.crossDomainError():void b.emit("end"):void 0},c.upload&&(c.upload.onprogress=function(a){a.percent=a.loaded/a.total*100,b.emit("progress",a)}),h&&!this._timer&&(this._timer=setTimeout(function(){b.abort()},h)),g&&(g=o.serializeObject(g),this.url+=~this.url.indexOf("?")?"&"+g:"?"+g),c.open(this.method,this.url,!0),"GET"!=this.method&&"HEAD"!=this.method&&"string"!=typeof i&&!e(i)){var j=o.serialize[this.getHeader("Content-Type")];j&&(i=j(i))}for(var k in this.header)null!=this.header[k]&&c.setRequestHeader(k,this.header[k]);return c.send(i),this},o.Request=n,o.get=function(a,b,c){var d=o("GET",a);return"function"==typeof b&&(c=b,b=null),b&&d.query(b),c&&d.end(c),d},o.head=function(a,b,c){var d=o("HEAD",a);return"function"==typeof b&&(c=b,b=null),b&&d.send(b),c&&d.end(c),d},o.del=function(a,b){var c=o("DELETE",a);return b&&c.end(b),c},o.patch=function(a,b,c){var d=o("PATCH",a);return"function"==typeof b&&(c=b,b=null),b&&d.send(b),c&&d.end(c),d},o.post=function(a,b,c){var d=o("POST",a);return"function"==typeof b&&(c=b,b=null),b&&d.send(b),c&&d.end(c),d},o.put=function(a,b,c){var d=o("PUT",a);return"function"==typeof b&&(c=b,b=null),b&&d.send(b),c&&d.end(c),d},c.exports=o}),a.alias("component-emitter/index.js","superagent/deps/emitter/index.js"),a.alias("component-emitter/index.js","emitter/index.js"),a.alias("component-indexof/index.js","component-emitter/deps/indexof/index.js"),a.alias("RedVentures-reduce/index.js","superagent/deps/reduce/index.js"),a.alias("RedVentures-reduce/index.js","reduce/index.js"),a.alias("superagent/lib/client.js","superagent/index.js"),"object"==typeof c?b.exports=a("superagent"):"function"==typeof define&&define.amd?define(function(){return a("superagent")}):this.superagent=a("superagent")}()},{emitter:14,indexof:14,reduce:14,superagent:14}],7:[function(a,b){"use strict";function c(a,b){this.walker=this.createWalker(a),this.walker.startUri=b,this.walker.request=this.request=e,this.walker.parseJson=JSON.parse,this.finalAction=new g(this.walker)}var d=a("minilog"),e=a("request"),f=a("util"),g=a("./final_action"),h=a("./json_walker"),i=a("./json_hal_walker"),j=a("./media_types"),k=d("traverson");c.prototype.createWalker=function(a){switch(a){case j.JSON:return k.debug("creating new JsonWalker"),new h;case j.JSON_HAL:return k.debug("creating new JsonHalWalker"),new i;default:throw new Error("Unknown or unsupported media type: "+a)}},c.prototype.follow=function(){return this.walker.links=1===arguments.length&&f.isArray(arguments[0])?arguments[0]:Array.prototype.slice.apply(arguments),this},c.prototype.walk=c.prototype.follow,c.prototype.withTemplateParameters=function(a){return this.walker.templateParameters=a,this},c.prototype.withRequestOptions=function(a){return this.walker.request=this.request=e.defaults(a),this},c.prototype.withRequestLibrary=function(a){return this.walker.request=this.request=a,this},c.prototype.parseResponseBodiesWith=function(a){return this.walker.parseJson=a,this},c.prototype.resolveRelative=function(){return this.walker.resolveRelative=!0,this},c.prototype.get=function(a){var b=this;this.walker.walk(function(c,d,e){return k.debug("walker.walk returned"),c?a(c,e.response,e.uri):void b.finalAction.get(d,a)})},c.prototype.getResource=function(a){var b=this;this.walker.walk(function(c,d,e){return k.debug("walker.walk returned"),c?a(c,e.response,e.uri):void b.finalAction.getResource(d,a)})},c.prototype.getUri=function(a){var b=this;this.walker.walk(function(c,d,e){return k.debug("walker.walk returned"),c?a(c,e.response,e.uri):void b.finalAction.getUri(d,a)})},c.prototype.post=function(a,b){this.finalAction.walkAndExecute(a,this.request,this.request.post,b)},c.prototype.put=function(a,b){this.finalAction.walkAndExecute(a,this.request,this.request.put,b)},c.prototype.patch=function(a,b){this.finalAction.walkAndExecute(a,this.request,this.request.patch,b)},c.prototype.del=function(a){this.finalAction.walkAndExecute(null,this.request,this.request.del,a)},b.exports=c},{"./final_action":8,"./json_hal_walker":9,"./json_walker":10,"./media_types":11,minilog:1,request:3,util:2}],8:[function(a,b){"use strict";function c(a){this.walker=a}var d=a("minilog"),e=d("traverson");c.prototype.get=function(a,b){e.debug("next step: "+JSON.stringify(a,null,2)),this.walker.process(a,function(a,c){return e.debug("walker.process returned"),a?b(a,c.response,c.uri):(!c.response&&c.doc&&(e.debug("faking HTTP response for embedded resource"),c.response={statusCode:200,body:JSON.stringify(c.doc),remark:"This is not an actual HTTP response. The resource you requested was an embedded resource, so no HTTP request was made to acquire it."}),void b(null,c.response))})},c.prototype.getResource=function(a,b){var c=this;e.debug("next step: "+JSON.stringify(a)),this.walker.process(a,function(a,d){if(e.debug("walker.process returned"),a)return b(a,d.response,d.uri);if(d.doc)return b(null,d.doc);var f;try{return c.walker.checkHttpStatus(d),f=c.walker.parse(d),b(null,f)}catch(g){return b(g,g.doc)}})},c.prototype.getUri=function(a,b){var c=this;return e.debug("returning uri"),a.uri?b(null,a.uri):a.doc&&a.doc._links&&a.doc._links.self&&a.doc._links.self.href?b(null,c.walker.startUri+a.doc._links.self.href):b(new Error('You requested an URI but the last resource is an embedded resource and has no URI of its own (that is, it has no link with rel="self"'))},c.prototype.walkAndExecute=function(a,b,c,d){var f=this;this.walker.walk(function(g,h,i){return e.debug("walker.walk returned"),g?d(g,i.response,i.uri):(e.debug("executing final request with step: "+JSON.stringify(h)),void f.executeRequest(h.uri,b,c,a,d))})},c.prototype.executeRequest=function(a,b,c,d,f){var g;g=d?{body:JSON.stringify(d)}:{},e.debug("request to "+a+" with options "+JSON.stringify(g)),c.call(b,a,g,function(b,c){return e.debug("request to "+a+" succeeded"),b?f(b,c,a):f(null,c,a)})},b.exports=c},{minilog:1}],9:[function(a,b){"use strict";function c(){}function d(a){var b=a.match(/(.*)\[(.*):(.*)\]/);return b?{key:b[1],secondaryKey:b[2],secondaryValue:b[3],index:null,all:!1}:(b=a.match(/(.*)\[(\d+)\]/))?{key:b[1],secondaryKey:null,secondaryValue:null,index:b[2],all:!1}:(b=a.match(/(.*)\[\$all\]/),b?{key:b[1],secondaryKey:null,secondaryValue:null,index:null,all:!0}:{key:a,secondaryKey:null,secondaryValue:null,index:null,all:!1})}function e(a,b){a.hasCuries()&&(b.curie=a.reverseResolveCurie(b.key))}function f(a,b){var c=a.linkArray(b.key);if(c||(c=a.linkArray(b.curie)),!c||0===c.length)return null;var d=g(c,b);return d||(d=h(c,b)),d||(d=i(c,b)),d}function g(a,b){if(b.secondaryKey&&b.secondaryValue){for(var c=0;c<a.length;c++){var d=a[c][b.secondaryKey];if(null!=d&&d==b.secondaryValue){if(!a[c].href)throw new Error(b.key+"["+b.secondaryKey+":"+b.secondaryValue+"] requested, but this link had no href attribute.");return p.debug("found hal link: "+a[c].href),{uri:a[c].href}}}throw new Error(b.key+"["+b.secondaryKey+":"+b.secondaryValue+"] requested, but there is no such link.")}return null}function h(a,b){if("undefined"!=typeof b.index&&null!==b.index){if(!a[b.index])throw new Error(b.key+"["+b.index+"] requested, but link array "+b.key+" had no element at index "+b.index);if(!a[b.index].href)throw new Error(b.key+"["+b.index+"] requested, but this link had no href attribute.");return p.debug("found hal link: "+a[b.index].href),{uri:a[b.index].href}}return null}function i(a,b){for(var c,d=0;d<a.length;d++)if(a[d].href){c=a[d];break}return c?(a.length>1&&p.warn("Found HAL link array with more than one element for key "+b.key+", arbitrarily choosing index "+d+", because it was the first that had a href attribute."),p.debug("found hal link: "+c.href),{uri:c.href}):null}function j(a,b,c){p.debug("checking for embedded: "+c.key+(c.index?c.index:""));var d=a.embeddedArray(c.key);if(!d||0===d.length)return null;p.debug("Found an array of embedded resource for: "+c.key);var e=k(d,c,a);return e||(e=l(d,c)),e}function k(a,b,c){if(b.all)return{doc:c.original()._embedded[b.key]};if(b.index){if(!a[b.index])throw new Error(b.key+"["+b.index+"] requested, but there is no such link. However, there is an embedded resource array named "+b.key+" but it does not have an element at index "+b.index);return p.debug("Found an embedded resource for: "+b.key+"["+b.index+"]"),{doc:a[b.index].original()}}return null}function l(a,b){return a.length>1&&p.warn("Found HAL embedded resource array with more than one element  for key "+b.key+", arbitrarily choosing first element."),{doc:a[0].original()}}var m=a("halfred"),n=a("minilog"),o=(a("underscore.string"),a("./walker")),p=n("traverson");c.prototype=new o,c.prototype.findNextStep=function(a,b){p.debug("parsing hal");var c=m.parse(a),g=d(b);e(c,g);var h=f(c,g);if(h)return h;if(h=j(c,a,g))return h;throw new Error("Could not find a link nor an embedded object for "+JSON.stringify(g)+" in document:\n"+JSON.stringify(a))},b.exports=c},{"./walker":12,halfred:17,minilog:1,"underscore.string":4}],10:[function(a,b){"use strict";function c(){}var d=a("./walker");c.prototype=new d,b.exports=c},{"./walker":12}],11:[function(a,b){"use strict";b.exports={JSON:"application/json",JSON_HAL:"application/hal+json"}},{}],12:[function(a,b){"use strict";function c(){}function d(a,b,c){var d=new Error("HTTP GET for "+a+" resulted in HTTP status code "+b+".");d.name="HTTPError",d.uri=a,d.httpStatus=b,d.body=c;try{d.doc=JSON.parse(c)}catch(e){}return d}function e(a,b){var c=new Error("The document at "+a+" could not be parsed as JSON: "+b);return c.name="JSONError",c.uri=a,c.body=b,c}var f=a("JSONPath"),g=a("minilog"),h=a("underscore.string"),i=a("url-template"),j=a("url"),k=a("util"),l=f.eval,m=g("traverson");c.prototype.walk=function(a){function b(){return e<c.links.length?void c.process(d,function(g,h){if(f=h,g)return m.debug("error while processing step "+JSON.stringify(d)),m.error(g),a(g,d,h);m.debug("successully processed step");try{c.checkHttpStatus(h)}catch(i){return m.error("unexpected http status code"),m.error(i),a(i,d,h)}var j;try{j=c.parse(h)}catch(i){return m.error("parsing failed"),m.error(i),a(i,d,h)}var k=c.links[e++];m.debug("next link: "+k);try{d=c.findNextStep(j,k)}catch(i){return m.error("could not find next step"),m.error(i),a(i,d,h)}d.uri&&(d.uri=c.resolveUriTemplate(d.uri,c.templateParameters,e)),c.postProcessStep(d,h),m.debug("next step: "+JSON.stringify(d,null,2)),b()}):(m.debug("link array exhausted, calling callback"),a(null,d,f))}var c=this,d={uri:this.resolveUriTemplate(this.startUri,this.templateParameters,0)},e=0,f=d;m.debug("starting to follow links"),b()},c.prototype.process=function(a,b){if(m.debug("processing next step: "+JSON.stringify(a,null,2)),a.uri)this.get(a,b);else{if(!a.doc)throw new Error("Can not process next step: "+JSON.stringify(a));m.debug("document for next step has already been fetched"),b(null,a)}},c.prototype.get=function(a,b){m.debug("request to "+a.uri),this.request.get(a.uri,function(c,d,e){return e&&!d.body&&(d.body=e),m.debug("request.get returned"),c?b(c,a):(m.debug("request to "+a.uri+" finished ("+d.statusCode+")"),a.response=d,b(null,a))})},c.prototype.checkHttpStatus=function(a){if(a.response||!a.doc){var b=a.response.statusCode;if(200>b||b>=300)throw d(a.uri,b,a.response.body)}},c.prototype.parse=function(a){if(a.doc)return a.doc;try{return this.parseJson(a.response.body)}catch(b){if("SyntaxError"===b.name)throw e(a.uri,a.response.body);throw b}},c.prototype.findNextStep=function(a,b){m.debug("extracting link "+b+" from "+JSON.stringify(a));if(this.testJSONPath(b))return{uri:this.resolveJSONPath(b,a)};if(a[b])return{uri:a[b]};throw new Error("Could not find property "+b+" in document:\n"+JSON.stringify(a))},c.prototype.postProcessStep=function(a,b){a.uri&&(h.startsWith(a.uri,"http://")||(this.resolveRelative&&b&&b.uri?(h.startsWith(a.uri,"/")&&h.endsWith(b.uri,"/")&&(a.uri=h.splice(a.uri,0,1)),a.uri=b.uri+a.uri):a.uri=j.resolve(this.startUri,a.uri)))},c.prototype.testJSONPath=function(a){return h.startsWith(a,"$.")||h.startsWith(a,"$[")},c.prototype.resolveJSONPath=function(a,b){var c=l(b,a);if(1===c.length){var d=c[0];if(!d)throw new Error("JSONPath expression "+a+" was resolved but the result was null, undefined or an empty string in document:\n"+JSON.stringify(b));return d}throw new Error(c.length>1?"JSONPath expression "+a+" returned more than one match in document:\n"+JSON.stringify(b):"JSONPath expression "+a+" returned no match in document:\n"+JSON.stringify(b))},c.prototype.resolveUriTemplate=function(a,b,c){if(k.isArray(b)&&(b=b[c]),b||(b={}),h.contains(a,"{")){var d=i.parse(a);return d.expand(b)}return a},b.exports=c},{JSONPath:13,minilog:1,"underscore.string":4,url:5,"url-template":22,util:2}],13:[function(require,module,exports){var isNode=!1;!function(exports,require){function push(a,b){return a=a.slice(),a.push(b),a}function unshift(a,b){return b=b.slice(),b.unshift(a),b}function jsonPath(a,b,c){var d={resultType:c&&c.resultType||"VALUE",flatten:c&&c.flatten||!1,wrap:c&&c.hasOwnProperty("wrap")?c.wrap:!0,sandbox:c&&c.sandbox?c.sandbox:{},normalize:function(a){if(cache[a])return cache[a];var b=[],c=a.replace(/[\['](\??\(.*?\))[\]']/g,function(a,c){return"[#"+(b.push(c)-1)+"]"}).replace(/'?\.'?|\['?/g,";").replace(/(;)?(\^+)(;)?/g,function(a,b,c){return";"+c.split("").join(";")+";"}).replace(/;;;|;;/g,";..;").replace(/;$|'?\]|'$/g,""),d=c.split(";").map(function(a){var c=a.match(/#([0-9]+)/);return c&&c[1]?b[c[1]]:a});return cache[a]=d},asPath:function(a){for(var b=a,c="$",d=1,e=b.length;e>d;d++)c+=/^[0-9*]+$/.test(b[d])?"["+b[d]+"]":"['"+b[d]+"']";return c},trace:function(a,b,c){function e(a){h=h.concat(a)}if(!a.length)return[{path:c,value:b}];var f=a[0],g=a.slice(1);if("^"===f)return c.length?[{path:c.slice(0,-1),expr:g,isParentSelector:!0}]:[];var h=[];if(b&&b.hasOwnProperty(f))e(d.trace(g,b[f],push(c,f)));else if("*"===f)d.walk(f,g,b,c,function(a,b,c,f,g){e(d.trace(unshift(a,c),f,g))});else if(".."===f)e(d.trace(g,b,c)),d.walk(f,g,b,c,function(a,b,c,f,g){"object"==typeof f[a]&&e(d.trace(unshift("..",c),f[a],push(g,a)))});else if("("===f[0])e(d.trace(unshift(d.eval(f,b,c[c.length],c),g),b,c));else if(0===f.indexOf("?("))d.walk(f,g,b,c,function(a,b,f,g,h){d.eval(b.replace(/^\?\((.*?)\)$/,"$1"),g[a],a,c)&&e(d.trace(unshift(a,f),g,h))});else if(f.indexOf(",")>-1)for(var i=f.split(","),j=0;j<i.length;j++)e(d.trace(unshift(i[j],g),b,c));else/^(-?[0-9]*):(-?[0-9]*):?([0-9]*)$/.test(f)&&e(d.slice(f,g,b,c));return h.reduce(function(a,c){return a.concat(c.isParentSelector?d.trace(c.expr,b,c.path):[c])},[])},walk:function(a,b,c,d,e){if(Array.isArray(c))for(var f=0,g=c.length;g>f;f++)e(f,a,b,c,d);else if("object"==typeof c)for(var h in c)c.hasOwnProperty(h)&&e(h,a,b,c,d)},slice:function(a,b,c,e){if(Array.isArray(c)){var f=c.length,g=a.split(":"),h=g[0]&&parseInt(g[0])||0,i=g[1]&&parseInt(g[1])||f,j=g[2]&&parseInt(g[2])||1;h=0>h?Math.max(0,h+f):Math.min(f,h),i=0>i?Math.max(0,i+f):Math.min(f,i);for(var k=[],l=h;i>l;l+=j)k=k.concat(d.trace(unshift(l,b),c,e));return k}},eval:function(a,b,c,f){if(!e||!b)return!1;a.indexOf("@path")>-1&&(d.sandbox._path=d.asPath(f.concat([c])),a=a.replace(/@path/g,"_path")),a.indexOf("@")>-1&&(d.sandbox._v=b,a=a.replace(/@/g,"_v"));try{return vm.runInNewContext(a,d.sandbox)}catch(g){throw console.log(g),new Error("jsonPath: "+g.message+": "+a)}}},e=a,f=d.resultType.toLowerCase();if(b&&a&&("value"==f||"path"==f)){var g=d.normalize(b);"$"===g[0]&&g.length>1&&g.shift();var h=d.trace(g,a,["$"]);return h=h.filter(function(a){return a&&!a.isParentSelector}),h.length?1!==h.length||d.wrap||Array.isArray(h[0].value)?h.reduce(function(a,b){var c=b[f];return"path"===f&&(c=d.asPath(c)),d.flatten&&Array.isArray(c)?a=a.concat(c):a.push(c),a},[]):h[0][f]||!1:d.wrap?[]:!1}}Array.isArray||(Array.isArray=function(a){return"[object Array]"===Object.prototype.toString.call(a)});var isNode="undefined"!=typeof module&&!!module.exports,vm=isNode?require("vm"):{runInNewContext:function(expr,context){with(context)return eval(expr)}};exports.eval=jsonPath;var cache={}}("undefined"==typeof exports?this.jsonPath={}:exports,"undefined"==typeof require?null:require)},{vm:15}],14:[function(){},{}],15:[function(require,module,exports){function Context(){}var indexOf=require("indexof"),Object_keys=function(a){if(Object.keys)return Object.keys(a);var b=[];for(var c in a)b.push(c);return b},forEach=function(a,b){if(a.forEach)return a.forEach(b);for(var c=0;c<a.length;c++)b(a[c],c,a)},defineProp=function(){try{return Object.defineProperty({},"_",{}),function(a,b,c){Object.defineProperty(a,b,{writable:!0,enumerable:!1,configurable:!0,value:c})}}catch(a){return function(a,b,c){a[b]=c}}}(),globals=["Array","Boolean","Date","Error","EvalError","Function","Infinity","JSON","Math","NaN","Number","Object","RangeError","ReferenceError","RegExp","String","SyntaxError","TypeError","URIError","decodeURI","decodeURIComponent","encodeURI","encodeURIComponent","escape","eval","isFinite","isNaN","parseFloat","parseInt","undefined","unescape"];Context.prototype={};var Script=exports.Script=function(a){return this instanceof Script?void(this.code=a):new Script(a)};Script.prototype.runInContext=function(a){if(!(a instanceof Context))throw new TypeError("needs a 'context' argument.");var b=document.createElement("iframe");b.style||(b.style={}),b.style.display="none",document.body.appendChild(b);var c=b.contentWindow,d=c.eval,e=c.execScript;!d&&e&&(e.call(c,"null"),d=c.eval),forEach(Object_keys(a),function(b){c[b]=a[b]}),forEach(globals,function(b){a[b]&&(c[b]=a[b])});var f=Object_keys(c),g=d.call(c,this.code);return forEach(Object_keys(c),function(b){(b in a||-1===indexOf(f,b))&&(a[b]=c[b])}),forEach(globals,function(b){b in a||defineProp(a,b,c[b])}),document.body.removeChild(b),g},Script.prototype.runInThisContext=function(){return eval(this.code)},Script.prototype.runInNewContext=function(a){var b=Script.createContext(a),c=this.runInContext(b);return forEach(Object_keys(b),function(c){a[c]=b[c]}),c},forEach(Object_keys(Script.prototype),function(a){exports[a]=Script[a]=function(b){var c=Script(b);return c[a].apply(c,[].slice.call(arguments,1))}}),exports.createScript=function(a){return exports.Script(a)},exports.createContext=Script.createContext=function(a){var b=new Context;return"object"==typeof a&&forEach(Object_keys(a),function(c){b[c]=a[c]}),b}},{indexof:16}],16:[function(a,b){var c=[].indexOf;b.exports=function(a,b){if(c)return a.indexOf(b);for(var d=0;d<a.length;++d)if(a[d]===b)return d;return-1}},{}],17:[function(a,b){var c=a("./lib/parser"),d=!1;b.exports={parse:function(a){return(new c).parse(a,d)},enableValidation:function(a){d=null!=a?a:!0},disableValidation:function(){d=!1}}},{"./lib/parser":19}],18:[function(a,b){"use strict";function c(){this._array=arguments.length>=1?arguments[0]:[]}c.prototype.array=function(){return this._array},c.prototype.isEmpty=function(){return 0===this._array.length},c.prototype.push=function(a){var b=this._array.slice(0);return b.push(a),new c(b)},c.prototype.pop=function(){var a=this._array.slice(0,this._array.length-1);return new c(a)},c.prototype.peek=function(){if(this.isEmpty())throw new Error("can't peek on empty stack");return this._array[this._array.length-1]},b.exports=c},{}],19:[function(a,b){"use strict";function c(){}function d(a,b,c){if(null==a)return a;var d=e(a._links,b,c.push("_links")),i=f(d),j=g(a._embedded,b,c.push("_embedded")),k=new r(d,i,j,b);return h(a,k),k._original=a,k}function e(a,b,c){return a=i(a,k,b,c),(null==a||null==a.self)&&n("Resource does not have a self link",b,c),a}function f(a){return a?a.curies:[]}function g(a,b,c){var e=i(a,m,b,c);return null==e?e:(Object.keys(e).forEach(function(a){e[a]=e[a].map(function(e){var f=null!=b?[]:null,g=d(e,f,c.push(a));return g._original=e,g})}),e)}function h(a,b){Object.keys(a).forEach(function(c){"_links"!==c&&"_embedded"!==c&&(b[c]=a[c])})}function i(a,b,c,d){if(null==a)return a;var e={};return Object.keys(a).forEach(function(f){e[f]=j(f,a[f],b,c,d)}),e}function j(a,b,c,d,e){return l(b)?b.map(function(b){return c(a,b,d,e)}):[c(a,b,d,e)]}function k(a,b,c,d){var e=p(b);return Object.keys(t).forEach(function(b){null==e[b]&&(t[b].required&&n("Link misses required property "+b+".",c,d.push(a)),null!=t[b].defaultValue&&(e[b]=t[b].defaultValue))}),e.deprecation&&o("Warning: Link "+q(d.push(a))+" is deprecated, see "+e.deprecation),e.templated!==!0&&e.templated!==!1&&(e.templated=!1),c?(e.href&&e.href.indexOf("{")>=0&&!e.templated&&n('Link seems to be an URI template but its "templated" property is not set to true.',c,d.push(a)),e):e}function l(a){return"[object Array]"===Object.prototype.toString.call(a)}function m(a,b){return b}function n(a,b,c){b&&b.push({path:q(c),message:a})}function o(a){"undefined"!=typeof console&&"function"==typeof console.log&&console.log(a)}function p(a){var b={};return Object.keys(a).forEach(function(c){b[c]=a[c]}),b}function q(a){for(var b="$.",c=0;c<a.array().length;c++)b+=a.array()[c]+".";return b=b.substring(0,b.length-1)}var r=a("./resource"),s=a("./immutable_stack"),t={href:{required:!0,defaultValue:null},templated:{required:!1,defaultValue:!1},type:{required:!1,defaultValue:null},deprecation:{required:!1,defaultValue:null},name:{required:!1,defaultValue:null},profile:{required:!1,defaultValue:null},title:{required:!1,defaultValue:null},hreflang:{required:!1,defaultValue:null}};
c.prototype.parse=function(a,b){var c=b?[]:null;return d(a,c,new s)},b.exports=c},{"./immutable_stack":18,"./resource":20}],20:[function(a,b){"use strict";function c(a,b,c,d){this._links=a||{},this._initCuries(b),this._embedded=c||{},this._validation=d||[]}function d(a,b){return null!=a?a[b]:null}function e(a,b,c){c=c||0;var e=d(a,b);return null!=e&&e.length>=1?e[c]:null}c.prototype._initCuries=function(a){if(this._curiesMap={},a){this._curies=a;for(var b=0;b<this._curies.length;b++){var c=this._curies[b];this._curiesMap[c.name]=c}}else this._curies=[];this._preResolveCuries()},c.prototype._preResolveCuries=function(){this._resolvedCuriesMap={};for(var a=0;a<this._curies.length;a++){var b=this._curies[a];if(b.name)for(var c in this._links)"curies"!==c&&this._preResolveCurie(b,c)}},c.prototype._preResolveCurie=function(a,b){var c=(this._links[b],b.split(/:(.+)/)),d=c[0];if(a.name===d)if(a.templated&&c.length>=1){var e=a.href.replace(/(.*){(.*)}(.*)/,"$1"+c[1]+"$3");this._resolvedCuriesMap[e]=b}else this._resolvedCuriesMap[a.href]=b},c.prototype.allLinkArrays=function(){return this._links},c.prototype.linkArray=function(a){return d(this._links,a)},c.prototype.link=function(a,b){return e(this._links,a,b)},c.prototype.hasCuries=function(){return this._curies.length>0},c.prototype.curieArray=function(){return this._curies},c.prototype.curie=function(a){return this._curiesMap[a]},c.prototype.reverseResolveCurie=function(a){return this._resolvedCuriesMap[a]},c.prototype.allEmbeddedResourceArrays=function(){return this._embedded},c.prototype.embeddedResourceArray=function(a){return d(this._embedded,a)},c.prototype.embeddedResource=function(a,b){return e(this._embedded,a,b)},c.prototype.original=function(){return this._original},c.prototype.validationIssues=function(){return this._validation},c.prototype.allLinks=c.prototype.allLinkArrays,c.prototype.allEmbeddedArrays=c.prototype.allEmbeddedResources=c.prototype.allEmbeddedResourceArrays,c.prototype.embeddedArray=c.prototype.embeddedResourceArray,c.prototype.embedded=c.prototype.embeddedResource,c.prototype.validation=c.prototype.validationIssues,b.exports=c},{}],21:[function(a,b,c){void function(a,d){"function"==typeof define&&define.amd?define(d):"object"==typeof c?b.exports=d():a.resolveUrl=d()}(this,function(){function a(){var a=arguments.length;if(0===a)throw new Error("resolveUrl requires at least one argument; got none.");var b=document.createElement("base");if(b.href=arguments[0],1===a)return b.href;var c=document.getElementsByTagName("head")[0];c.insertBefore(b,c.firstChild);for(var d,e=document.createElement("a"),f=1;a>f;f++)e.href=arguments[f],d=e.href,b.href=d;return c.removeChild(b),d}return a})},{}],22:[function(a,b,c){!function(a,d){"object"==typeof c?b.exports=d():"function"==typeof define&&define.amd?define([],d):a.urltemplate=d()}(this,function(){function a(){}return a.prototype.encodeReserved=function(a){return a.split(/(%[0-9A-Fa-f]{2})/g).map(function(a){return/%[0-9A-Fa-f]/.test(a)||(a=encodeURI(a)),a}).join("")},a.prototype.encodeValue=function(a,b,c){return b="+"===a||"#"===a?this.encodeReserved(b):encodeURIComponent(b),c?encodeURIComponent(c)+"="+b:b},a.prototype.isDefined=function(a){return void 0!==a&&null!==a},a.prototype.isKeyOperator=function(a){return";"===a||"&"===a||"?"===a},a.prototype.getValues=function(a,b,c,d){var e=a[c],f=[];if(this.isDefined(e)&&""!==e)if("string"==typeof e||"number"==typeof e||"boolean"==typeof e)e=e.toString(),d&&"*"!==d&&(e=e.substring(0,parseInt(d,10))),f.push(this.encodeValue(b,e,this.isKeyOperator(b)?c:null));else if("*"===d)Array.isArray(e)?e.filter(this.isDefined).forEach(function(a){f.push(this.encodeValue(b,a,this.isKeyOperator(b)?c:null))},this):Object.keys(e).forEach(function(a){this.isDefined(e[a])&&f.push(this.encodeValue(b,e[a],a))},this);else{var g=[];Array.isArray(e)?e.filter(this.isDefined).forEach(function(a){g.push(this.encodeValue(b,a))},this):Object.keys(e).forEach(function(a){this.isDefined(e[a])&&(g.push(encodeURIComponent(a)),g.push(this.encodeValue(b,e[a].toString())))},this),this.isKeyOperator(b)?f.push(encodeURIComponent(c)+"="+g.join(",")):0!==g.length&&f.push(g.join(","))}else";"===b?f.push(encodeURIComponent(c)):""!==e||"&"!==b&&"?"!==b?""===e&&f.push(""):f.push(encodeURIComponent(c)+"=");return f},a.prototype.parse=function(a){var b=this,c=["+","#",".","/",";","?","&"];return{expand:function(d){return a.replace(/\{([^\{\}]+)\}|([^\{\}]+)/g,function(a,e,f){if(e){var g=null,h=[];if(-1!==c.indexOf(e.charAt(0))&&(g=e.charAt(0),e=e.substr(1)),e.split(/,/g).forEach(function(a){var c=/([^:\*]*)(?::(\d+)|(\*))?/.exec(a);h.push.apply(h,b.getValues(d,g,c[1],c[2]||c[3]))}),g&&"+"!==g){var i=",";return"?"===g?i="&":"#"!==g&&(i=g),(0!==h.length?g:"")+h.join(i)}return h.join(",")}return b.encodeReserved(f)})}}},new a})},{}],traverson:[function(a,b){b.exports=a("BIsrf7")},{}],BIsrf7:[function(a,b){"use strict";var c=(a("minilog"),a("./lib/media_types")),d=a("./lib/builder");b.exports={_Builder:d,json:{from:function(a){return{newRequest:function(){return new d(c.JSON,a)}}}},jsonHal:{from:function(a){return{newRequest:function(){return new d(c.JSON_HAL,a)}}}}}},{"./lib/builder":7,"./lib/media_types":11,minilog:1}]},{},["BIsrf7"]);